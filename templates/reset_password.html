{% extends "base.html" %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center min-vh-100 py-4 px-2">
    <div class="card glass-card p-4 text-center position-relative"
         style="width: 100%; max-width: 380px; min-height: 440px;">

        <div class="logo-badge">
            <img src="{{ url_for('static', filename='img/barb_logo.png') }}" alt="BARB Logo">
        </div>

        <div class="mt-5 pt-3">
            <h5 class="mb-2 fw-bold text-dark">Create New Password</h5>
            <p class="text-secondary small mb-3">
                Choose a strong password you haven't used before.
            </p>

            {# IMPORTANT: no explicit action; posts back to /reset-password/<token> #}
            <form method="POST">
                <div class="mb-3 text-start">
                    <label class="form-label small fw-bold text-secondary mb-1">
                        NEW PASSWORD
                    </label>
                    <div class="input-group">
                        <input type="password"
                               name="password"
                               class="form-control"
                               id="newPassword"
                               placeholder="New password"
                               required
                               style="border-right: 0;">
                        <span class="input-group-text bg-white border-start-0"
                              style="cursor: pointer;"
                              onclick="togglePassword('newPassword', 'eyeNew')">
                            <i class="fas fa-eye text-muted" id="eyeNew"></i>
                        </span>
                    </div>
                </div>

                <div class="mb-3 text-start">
                    <label class="form-label small fw-bold text-secondary mb-1">
                        CONFIRM PASSWORD
                    </label>
                    <div class="input-group">
                        <input type="password"
                               name="confirm_password"
                               class="form-control"
                               id="confirmPassword"
                               placeholder="Repeat password"
                               required
                               style="border-right: 0;">
                        <span class="input-group-text bg-white border-start-0"
                              style="cursor: pointer;"
                              onclick="togglePassword('confirmPassword', 'eyeConfirm')">
                            <i class="fas fa-eye text-muted" id="eyeConfirm"></i>
                        </span>
                    </div>
                </div>

                <div class="bg-light rounded p-2 mb-3 text-start">
                    <small class="d-block text-muted fw-bold" style="font-size: 0.7rem;">
                        Password must be at least 8 characters and difficult to guess.
                    </small>
                </div>

                <button type="submit"
                        class="btn btn-success w-100 fw-bold py-2 mt-2">
                    UPDATE PASSWORD
                </button>
            </form>

            <div class="mt-4">
                <a href="{{ url_for('login') }}"
                   class="small text-secondary fw-bold">
                    Back to Login
                </a>
            </div>
        </div>

    </div>
</div>

<script>
    function togglePassword(fieldId, iconId) {
        const input = document.getElementById(fieldId);
        const icon = document.getElementById(iconId);
        if (input.type === "password") {
            input.type = "text";
            icon.classList.remove("fa-eye");
            icon.classList.add("fa-eye-slash");
        } else {
            input.type = "password";
            icon.classList.remove("fa-eye-slash");
            icon.classList.add("fa-eye");
        }
    }
</script>
{% endblock %}
